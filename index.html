<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mendieta Auto Group - Chat Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-enter {
            animation: slideUp 0.3s ease-out;
        }

        /* Typing indicator animation */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Custom scrollbar */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        #chat-messages::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        #chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Gradient background */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Send button hover effect */
        .send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .send-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen flex items-center justify-center p-4">
    <!-- Chat Widget -->
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col" style="height: 600px;">
        <!-- Header -->
        <div class="gradient-bg text-white px-6 py-4 flex items-center gap-3">
            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-2xl backdrop-blur-sm">
                ðŸš—
            </div>
            <div>
                <h1 class="text-xl font-bold">Mendieta Auto Group</h1>
                <p class="text-sm text-white/80">AI Sales Assistant</p>
            </div>
            <div class="ml-auto">
                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
            </div>
        </div>

        <!-- Messages Container -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4 bg-slate-50">
            <!-- Messages will be added here -->
        </div>

        <!-- Input Area -->
        <div class="bg-white border-t border-slate-200 p-4">
            <div class="flex gap-2">
                <input
                    type="text"
                    id="message-input"
                    placeholder="Ask about vehicles, financing, or schedule a test drive..."
                    class="flex-1 px-4 py-3 border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                >
                <button
                    id="send-button"
                    class="send-btn px-6 py-3 gradient-bg text-white rounded-xl font-semibold transition-all duration-200 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Send
                </button>
            </div>
        </div>
    </div>

    <script>
        let sessionId = null;
        // Auto-detect API URL: use /api for production (Vercel), localhost:8080 for local dev
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:8080'
            : '/api';
        const messagesContainer = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');

        // Add a message to the chat
        function addMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-enter flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;

            const bubble = document.createElement('div');
            bubble.className = `max-w-[80%] px-4 py-3 rounded-2xl ${
                type === 'user'
                    ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-tr-none'
                    : 'bg-white text-slate-800 shadow-md rounded-tl-none'
            }`;

            bubble.textContent = text;
            messageDiv.appendChild(bubble);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Add typing indicator
        function addTypingIndicator() {
            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'message-enter flex justify-start';

            const bubble = document.createElement('div');
            bubble.className = 'bg-white text-slate-800 shadow-md rounded-2xl rounded-tl-none px-4 py-3';

            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

            bubble.appendChild(typingIndicator);
            indicatorDiv.appendChild(bubble);
            messagesContainer.appendChild(indicatorDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // Send message to API
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Disable input
            sendButton.disabled = true;
            messageInput.disabled = true;

            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';

            // Show typing indicator
            addTypingIndicator();

            try {
                const response = await fetch(`${API_URL}/chat`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: message,
                        session_id: sessionId
                    })
                });

                const data = await response.json();
                sessionId = data.session_id;

                // Remove typing indicator and add bot response
                removeTypingIndicator();
                addMessage(data.message, 'bot');
            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, something went wrong. Please try again.', 'bot');
                console.error('Error:', error);
            } finally {
                // Re-enable input
                sendButton.disabled = false;
                messageInput.disabled = false;
                messageInput.focus();
            }
        }

        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Welcome message
        addMessage('Hi! Welcome to Mendieta Auto Group. How can I help you find your perfect vehicle today?', 'bot');
        messageInput.focus();
    </script>
</body>
</html>
